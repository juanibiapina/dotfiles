{
  "servers": {
    "knuspr": {
      "url": "https://mcp.knuspr.de/mcp/",
      "headers": {
        "rhl-email": "${ROHLIK_USERNAME}",
        "rhl-pass": "${ROHLIK_PASSWORD}"
      },
      "protocol_version": "2024-11-05",
      "server_info": {
        "name": "rohlik_mcp",
        "version": "2.14.5"
      },
      "tools": [
        {
          "name": "get_products_details_batch",
          "description": "Fetch current details for multiple products at once by their IDs. Use after getting product IDs from order history, favorites, shopping lists, or recipe ingredients. Efficiently retrieves up-to-date pricing, availability, and product info when you already know which products you need.",
          "inputSchema": {
            "properties": {
              "product_ids": {
                "description": "List of product IDs to get detailed information for. Retrieves data for multiple products in a single efficient batch request. Ex: [1234567, 7654321], list from order history or shopping list.",
                "items": {
                  "type": "integer"
                },
                "type": "array"
              }
            },
            "required": [
              "product_ids"
            ],
            "type": "object"
          }
        },
        {
          "name": "get_products_composition_batch",
          "description": "Retrieve composition, nutritional and allergen information for products. Use for comparing products nutritionally, checking allergens across a shopping list, or analyzing a recipe's total nutrition. Requires product IDs to analyze.",
          "inputSchema": {
            "properties": {
              "product_ids": {
                "description": "List of product IDs. Ex: [1234567, 7654321]",
                "items": {
                  "type": "integer"
                },
                "type": "array"
              }
            },
            "required": [
              "product_ids"
            ],
            "type": "object"
          }
        },
        {
          "name": "search_products",
          "description": "Search products by keyword, filters, or recommendations. Use for finding products, gifts, price comparisons, availability checks. Example queries: 'haben Sie Obst', 'günstigster Joghurt', 'empfiehl mir einen Wein', 'empfiehl mir einen Snack', 'Geschenk für Mama', 'teuerste', 'günstigste', 'Bio-Lebensmittel für Kinder', 'Angebote ohne Palmöl', 'Neuheiten', 'vegan'. Use include_fields to select response fields (default: compact set). Set include_nutritions/allergens/ingredients=true for composition data. Sort only when user explicitly requests cheapest/most expensive.",
          "inputSchema": {
            "$defs": {
              "ProductFilter": {
                "description": "Filter model for product search.",
                "properties": {
                  "filterSlug": {
                    "description": "Type of the filter. (i.e. slozeni, bez-alergenu, options, ...)",
                    "type": "string"
                  },
                  "valueSlug": {
                    "description": "Value of the filter. (i.e. neobsahuje-palmovy-olej, neobsahuje-mleko, news, ...)",
                    "type": "string"
                  }
                },
                "required": [
                  "filterSlug",
                  "valueSlug"
                ],
                "type": "object"
              }
            },
            "properties": {
              "keyword": {
                "default": null,
                "description": "Search keyword. Keywords must be localized for the tenant. Ex: 'Hähnchenbrust', 'Bio-Milch'",
                "type": "string"
              },
              "filters": {
                "anyOf": [
                  {
                    "items": {
                      "$ref": "#/$defs/ProductFilter"
                    },
                    "type": "array"
                  },
                  {
                    "type": "null"
                  }
                ],
                "default": null,
                "description": "Product filters with filter_slug and value_slug. Wrong filters return available ones. \nformat: `\u003cexample filter\u003e: [example values for given filter]`\nnews: ['news']\nsales: ['sales']\nkategorie: ['16-bananen-exoten', '2884-wurzelgemuese', '6-zwiebeln-knoblauch', '29-kochen-backen', '115-getraenke', '532-kuehlregal', '773-haushalt-buero', '4668-suesses-salziges', '833-baby-kinder', '712-drogerie']\nmarke: ['1112', '3bears', 'actimel', 'activia', 'ahead', 'airwaves', 'airwick', 'alb-gold', 'alete', 'allgroo']\nland: ['aegypten', 'argentinien', 'aethiopien', 'not_in_eu', 'australien', 'barbados', 'belgien', 'bosnia_und_herzegovina', 'brasilien', 'bulgarien']\n"
              },
              "sort_type": {
                "default": null,
                "description": "Sort: orderPriceAsc, orderPriceDesc, etc.",
                "type": "string"
              },
              "include_nutritions": {
                "default": false,
                "description": "Add nutritional values (energyKJ, energyKCal, fats, carbs, protein, salt)",
                "type": "boolean"
              },
              "include_allergens": {
                "default": false,
                "description": "Add allergen info (contained and possibly contained allergens)",
                "type": "boolean"
              },
              "include_ingredients": {
                "default": false,
                "description": "Add ingredients list",
                "type": "boolean"
              },
              "include_fields": {
                "default": null,
                "description": "Fields to include in response",
                "items": {
                  "type": "string"
                },
                "type": "array"
              }
            },
            "type": "object"
          }
        },
        {
          "name": "get_cart",
          "description": "View everything currently in the shopping cart with prices, quantities, and total cost. Use for reviewing before checkout, checking what's already added, calculating totals, or identifying savings from current promotions.",
          "inputSchema": {
            "properties": {},
            "type": "object"
          }
        },
        {
          "name": "update_cart_item",
          "description": "Change the quantity of a product already in the cart. Use when the user wants more or fewer of something they've added - 'actually make that 3 milks instead of 2' or reduce amounts before checkout.",
          "inputSchema": {
            "properties": {
              "product_id": {
                "description": "Product ID in cart. Ex: 1234567",
                "type": "integer"
              },
              "quantity": {
                "description": "New quantity (0 removes item). Ex: 2, 5",
                "type": "integer"
              }
            },
            "required": [
              "product_id",
              "quantity"
            ],
            "type": "object"
          }
        },
        {
          "name": "remove_cart_item",
          "description": "Take a specific product out of the cart entirely. Use when the user changes their mind about an item or wants to remove something before ordering.",
          "inputSchema": {
            "properties": {
              "product_id": {
                "description": "Product ID to remove from cart. Ex: 1234567",
                "type": "integer"
              }
            },
            "required": [
              "product_id"
            ],
            "type": "object"
          }
        },
        {
          "name": "clear_cart",
          "description": "Empty the entire cart at once, removing all items. Use when starting fresh, abandoning a planned order, or beginning a completely new shopping session. Cannot be undone.",
          "inputSchema": {
            "properties": {},
            "type": "object"
          }
        },
        {
          "name": "add_items_to_cart",
          "description": "Put products into the cart for purchase. The main way to build an order - use after finding products through search, from favorites, recipe ingredients, or shopping lists. Accepts multiple items at once for efficiency.",
          "inputSchema": {
            "$defs": {
              "Item": {
                "description": "Individual item for cart.",
                "properties": {
                  "productId": {
                    "description": "Required. ID of the product",
                    "type": "integer"
                  },
                  "quantity": {
                    "description": "Required. Quantity of the product",
                    "type": "number"
                  },
                  "source": {
                    "default": "mcp",
                    "description": "Source identifier for the cart item",
                    "type": "string"
                  }
                },
                "required": [
                  "productId",
                  "quantity"
                ],
                "type": "object"
              }
            },
            "properties": {
              "items": {
                "description": "Items to add with product_id and quantity. Ex: [{'product_id': 1234567, 'quantity': 2}]",
                "items": {
                  "$ref": "#/$defs/Item"
                },
                "type": "array"
              }
            },
            "required": [
              "items"
            ],
            "type": "object"
          }
        },
        {
          "name": "get_checkout",
          "description": "Get complete checkout form data with all sections and validation status. Returns address, payment, timeslot, packaging, cart total, and validation warnings. Use to review checkout before finalizing.",
          "inputSchema": {
            "properties": {},
            "type": "object"
          }
        },
        {
          "name": "submit_checkout",
          "description": "Submit the checkout to complete the order. Submits the current checkout with all selected options (address, payment method, timeslot, etc.) and any required agreement confirmations to finalize the order. Returns submission result with status, messages, and order completion data.",
          "inputSchema": {
            "properties": {},
            "type": "object"
          }
        },
        {
          "name": "change_checkout_packaging",
          "description": "Change packaging for checkout. Switch between PAPER_BAGS and REUSABLE_BAGS (eco-friendly, deposit refunded on return). Set before order submit.",
          "inputSchema": {
            "properties": {
              "selected_packaging": {
                "description": "Packaging type to select. Options: PAPER_BAGS, REUSABLE_BAGS (more eco-friendly, but requires deposit if the user doesn't have Xtra membership)",
                "enum": [
                  "PAPER_BAGS",
                  "REUSABLE_BAGS"
                ],
                "type": "string"
              }
            },
            "required": [
              "selected_packaging"
            ],
            "type": "object"
          }
        },
        {
          "name": "update_payment_method_checkout",
          "description": "Update payment method before checkout submit. AI agent orders: only CARD_ON_PLACE or CASH allowed (courier payment). Online methods require website.",
          "inputSchema": {
            "properties": {
              "selected_payment_method": {
                "description": "Payment method to select. Options: CARD_ON_PLACE (pay by card to courier), CASH (pay cash to courier)",
                "enum": [
                  "CARD_ON_PLACE",
                  "CASH"
                ],
                "type": "string"
              }
            },
            "required": [
              "selected_payment_method"
            ],
            "type": "object"
          }
        },
        {
          "name": "get_timeslots",
          "description": "Get available delivery timeslots for specific day. Returns time windows with prices, express slots, and capacity. Use timeslots_day: 0=today, 1=tomorrow, 2=day after, 3=three days out.",
          "inputSchema": {
            "properties": {
              "timeslots_day": {
                "description": "Day index: 0=today, 1=tomorrow, 2=day after, 3=three days out",
                "enum": [
                  0,
                  1,
                  2,
                  3
                ],
                "type": "integer"
              }
            },
            "required": [
              "timeslots_day"
            ],
            "type": "object"
          }
        },
        {
          "name": "change_timeslot_checkout",
          "description": "Change selected timeslot during checkout. Requires timeslot_id from get_timeslots response. Match exact customer time request - whole-hour slots (10:00-11:00) differ from quarter-hour slots (10:00-10:15).",
          "inputSchema": {
            "properties": {
              "timeslot_id": {
                "type": "string"
              }
            },
            "required": [
              "timeslot_id"
            ],
            "type": "object"
          }
        },
        {
          "name": "get_recipe_detail",
          "description": "Get recipe cooking instructions, ingredient list, and optional product mapping. Use after search to see prep steps and shopping requirements. Example queries: 'wie lange kochen', 'passende Beilage'. Mapping shows matching products with prices.",
          "inputSchema": {
            "properties": {
              "recipe_id": {
                "description": "Recipe ID. Ex: 12345",
                "type": "integer"
              },
              "include_product_mapping": {
                "default": true,
                "description": "Map ingredients to purchaseable products",
                "type": "boolean"
              },
              "include_meta": {
                "anyOf": [
                  {
                    "items": {
                      "type": "string"
                    },
                    "type": "array"
                  },
                  {
                    "type": "null"
                  }
                ],
                "default": null,
                "description": "Metadata: 'image', 'author', 'link'"
              },
              "include_brand": {
                "default": false,
                "description": "Include brand names for products",
                "type": "boolean"
              },
              "include_prices": {
                "default": "basic",
                "description": "Price details: 'basic' (unit+ sale) or 'full' (add original+currency)",
                "type": "string"
              }
            },
            "required": [
              "recipe_id"
            ],
            "type": "object"
          }
        },
        {
          "name": "generate_recipe_with_ingredients_search",
          "description": "Generate custom recipe and find matching store products. Use for recipes based on products they're buying or personalized meal ideas. Example queries: 'ich möchte einen Schweinebraten kaufen... hast du ein Rezept dafür'. Matched products can be added to cart.",
          "inputSchema": {
            "properties": {
              "user_query": {
                "description": "Recipe request. Ex: 'Abendessen für 4 mit Hähnchen'",
                "type": "string"
              }
            },
            "required": [
              "user_query"
            ],
            "type": "object"
          }
        },
        {
          "name": "search_recipes_by_vector_similarity",
          "description": "Find recipes by ingredients, meal type, or dietary needs. Semantic search. Example queries: 'Rezept mit Brokkoli und Kartoffeln', 'Rezepte mit Schweinefleisch', 'was kann ich aus meiner letzten Bestellung kochen', 'ich habe Spinat im Kühlschrank', 'glutenfrei und laktosefrei', 'Leberdiät', 'Diabetiker', 'Vegetarier', 'Rezeptideen', 'einfaches Gericht', 'Rezepte für zwei Erwachsene'.",
          "inputSchema": {
            "properties": {
              "query": {
                "description": "A string describing the recipe you are searching for. Can be in natural language.",
                "type": "string"
              },
              "limit": {
                "default": 5,
                "description": "Maximum recipes to return (max 5)",
                "type": "integer"
              },
              "include_meta": {
                "anyOf": [
                  {
                    "items": {
                      "type": "string"
                    },
                    "type": "array"
                  },
                  {
                    "type": "null"
                  }
                ],
                "default": null,
                "description": "Metadata: ['course', 'cuisine', 'authorName']"
              }
            },
            "required": [
              "query"
            ],
            "type": "object"
          }
        },
        {
          "name": "get_user_info",
          "description": "Retrieve the user's account profile including name, email, and contact details. Use for personalized greetings, confirming account settings, or when the user asks about their profile information.",
          "inputSchema": {
            "properties": {},
            "type": "object"
          }
        },
        {
          "name": "fetch_orders",
          "description": "Retrieve past/upcoming orders with full product details. Parameter selection: TIME PERIODS ('last year', 'December') → use date_from + date_to (YYYY-MM-DD). RECENT COUNT ('last 3 orders') → use limit. SPECIFIC ORDER → use order_id. Set order_type to delivered/upcoming/both. Use for reordering, claims, shopping lists, spending tracking.",
          "inputSchema": {
            "properties": {
              "order_id": {
                "anyOf": [
                  {
                    "type": "integer"
                  },
                  {
                    "type": "null"
                  }
                ],
                "default": null,
                "description": "Order ID to search for. If used, limit and date parameters are ignored."
              },
              "limit": {
                "anyOf": [
                  {
                    "maximum": 5,
                    "minimum": 1,
                    "type": "integer"
                  },
                  {
                    "type": "null"
                  }
                ],
                "default": null,
                "description": "Number of most recent orders (1-5). Use for count queries ('last 3 orders'). Do not use for time periods ('last year') - use date parameters instead."
              },
              "date_from": {
                "anyOf": [
                  {
                    "type": "string"
                  },
                  {
                    "type": "null"
                  }
                ],
                "default": null,
                "description": "Start date (YYYY-MM-DD). Use for time period queries: 'last year', 'December', 'summer', etc. Calculate from today's date (e.g., 'last year' = Jan 1 of previous year). Cannot equal date_to."
              },
              "date_to": {
                "anyOf": [
                  {
                    "type": "string"
                  },
                  {
                    "type": "null"
                  }
                ],
                "default": null,
                "description": "End date (YYYY-MM-DD). Use for time period queries: 'last year', 'December', 'summer', etc. Calculate from today's date (e.g., 'last year' = Dec 31 of previous year). Use with date_from."
              },
              "order_type": {
                "default": "delivered",
                "description": "Type of orders to fetch: 'delivered' for past delivered orders, 'upcoming' for active/upcoming orders, 'both' for all orders. Default is 'delivered'.",
                "enum": [
                  "delivered",
                  "upcoming",
                  "both"
                ],
                "type": "string"
              }
            },
            "type": "object"
          }
        },
        {
          "name": "repeat_order",
          "description": "Add all items from previous order to current cart. Use for repeat purchases. Needs order_id from order history.",
          "inputSchema": {
            "properties": {
              "order_id": {
                "description": "Order ID to repeat. Ex: 12345678",
                "type": "integer"
              }
            },
            "required": [
              "order_id"
            ],
            "type": "object"
          }
        },
        {
          "name": "analyze_spending",
          "description": "Analyze user spending patterns. Returns total spend, order count, average order value, monthly breakdown, and trends. Use date_from/date_to for time periods (YYYY-MM-DD format).",
          "inputSchema": {
            "properties": {
              "date_from": {
                "anyOf": [
                  {
                    "type": "string"
                  },
                  {
                    "type": "null"
                  }
                ],
                "default": null,
                "description": "Start date (YYYY-MM-DD). For 'last year' use Jan 1 of previous year. For 'this year' use Jan 1 of current year. Defaults to 3 months ago if not specified."
              },
              "date_to": {
                "anyOf": [
                  {
                    "type": "string"
                  },
                  {
                    "type": "null"
                  }
                ],
                "default": null,
                "description": "End date (YYYY-MM-DD). For 'last year' use Dec 31 of previous year. For 'this year' use today. Defaults to today if not specified."
              },
              "include_monthly_breakdown": {
                "default": true,
                "description": "Include month-by-month spending breakdown.",
                "type": "boolean"
              }
            },
            "type": "object"
          }
        },
        {
          "name": "calculate_average_user_order",
          "description": "Calculate average user order from purchase history. SIDE EFFECTS when add_to_cart=true: adds items to cart. Do NOT call twice - repeated calls cause duplicates.",
          "inputSchema": {
            "properties": {
              "add_to_cart": {
                "default": false,
                "type": "boolean"
              },
              "revert": {
                "default": false,
                "type": "boolean"
              }
            },
            "type": "object"
          }
        },
        {
          "name": "get_alternative_timeslots",
          "description": "Get available delivery timeslots for order across all available days (not limited to same day). MUST call this first before change_order_timeslot to get valid slot_id and slot_type values. Returns time windows with prices and express options.",
          "inputSchema": {
            "properties": {
              "order_id": {
                "description": "Order ID to get alternative timeslots for. Ex: 12345678",
                "type": "integer"
              }
            },
            "required": [
              "order_id"
            ],
            "type": "object"
          }
        },
        {
          "name": "change_order_timeslot",
          "description": "Change delivery timeslot for existing order to any available day (not limited to same day). PREREQUISITE: call get_alternative_timeslots first to get valid slot_id and slot_type. Types: EXPRESS (fast), ON_TIME (scheduled window), VIRTUAL (flexible). Match exact customer time - whole-hour slots differ from quarter-hour slots.",
          "inputSchema": {
            "properties": {
              "order_id": {
                "description": "Order ID to change timeslot for. Ex: 12345678",
                "type": "integer"
              },
              "slot_id": {
                "description": "Timeslot ID to change to. Get this from get_alternative_timeslots response.",
                "type": "integer"
              },
              "slot_type": {
                "description": "Type of the timeslot. Must be one of: EXPRESS, ON_TIME, VIRTUAL. Get this from get_alternative_timeslots response.",
                "enum": [
                  "EXPRESS",
                  "ON_TIME",
                  "VIRTUAL"
                ],
                "type": "string"
              }
            },
            "required": [
              "order_id",
              "slot_id",
              "slot_type"
            ],
            "type": "object"
          }
        },
        {
          "name": "get_user_credits",
          "description": "Check available credits and vouchers. Use before checkout or when asked about discounts. Shows balance, restrictions, expiration.",
          "inputSchema": {
            "properties": {},
            "type": "object"
          }
        },
        {
          "name": "get_all_user_favorites",
          "description": "See all products the user has marked as favorites. Use for quick reordering of beloved products, understanding taste preferences, or suggesting similar items the user might enjoy. Reveals shopping preferences and frequently purchased items.",
          "inputSchema": {
            "properties": {},
            "type": "object"
          }
        },
        {
          "name": "get_user_shopping_lists_preview",
          "description": "See all user's saved shopping lists with names and item counts. Use as first step when working with shopping lists - shows what lists exist before viewing details or adding items. Users often have lists like 'Weekly groceries', 'Party supplies', etc.",
          "inputSchema": {
            "properties": {},
            "type": "object"
          }
        },
        {
          "name": "get_user_shopping_list_detail",
          "description": "Get shopping list details with products, prices, and stock. Use after preview to see list contents.",
          "inputSchema": {
            "properties": {
              "shopping_list_id": {
                "description": "Shopping list ID.",
                "type": "integer"
              }
            },
            "required": [
              "shopping_list_id"
            ],
            "type": "object"
          }
        },
        {
          "name": "add_products_to_shopping_list",
          "description": "Add product to existing shopping list. Use after search when planning ahead instead of immediate cart add.",
          "inputSchema": {
            "properties": {
              "list_id": {
                "description": "Shopping list ID. Ex: 12345",
                "type": "integer"
              },
              "product_id": {
                "description": "Product ID to add. Ex: 1234567",
                "type": "integer"
              },
              "amount": {
                "description": "Quantity to add. Ex: 1, 3",
                "type": "integer"
              }
            },
            "required": [
              "list_id",
              "product_id",
              "amount"
            ],
            "type": "object"
          }
        },
        {
          "name": "create_shopping_list",
          "description": "Start a new shopping list with a custom name. Use when users want to organize purchases for different occasions, track ingredients for a meal plan, or separate personal from household shopping.",
          "inputSchema": {
            "properties": {
              "name": {
                "description": "List name. Ex: 'Weekly Groceries', 'Party Supplies'",
                "type": "string"
              },
              "product_id": {
                "anyOf": [
                  {
                    "type": "integer"
                  },
                  {
                    "type": "null"
                  }
                ],
                "default": null,
                "description": "Optional product ID to add immediately. Ex: 1234567"
              },
              "source": {
                "anyOf": [
                  {
                    "type": "string"
                  },
                  {
                    "type": "null"
                  }
                ],
                "default": null,
                "description": "Optional source tracking. Ex: 'recipe', 'manual'"
              }
            },
            "required": [
              "name"
            ],
            "type": "object"
          }
        },
        {
          "name": "get_faq_content",
          "description": "Fetch FAQ content for user's region (auto-detected). Returns markdown. Use for questions about store policies, loyalty programs, terms. Pass category slug (general, xtra_general, warranty, returnable_bags, terms_general, etc).",
          "inputSchema": {
            "properties": {
              "category": {
                "default": "general",
                "description": "FAQ category to fetch. Available categories:\n- 'general': General FAQs (orders, delivery, returns, account)\n- 'xtra_general': Xtra loyalty program (benefits, points, membership)\n- 'xtra_price': Xtra pricing and terms of use\n- 'baby_club': Baby club program for parents\n- 'christmas': Christmas seasonal information and offers\n- 'barrier_free': Accessibility/barrier-free delivery\n- 'referral': Referral program information\n- 'premium': Premium membership information\n- 'returnable_bags': Returnable/eco bags information\n- 'office_delivery': Office delivery program\n- 'rohlik_point': RohlikPoint pickup locations\n- 'gift_vouchers': Gift vouchers/cards\n- 'mcp_server': MCP server documentation\n- 'farmers_cooperation': Farmer/producer cooperation\n- 'partnership': Partnership opportunities\n- 'sustainability': Sustainability initiatives\n- 'flavor_heroes': Featured products/flavor heroes\n- 'terms_general': General terms and conditions\n- 'terms_baby_club': Baby club T\u0026C\n- 'terms_returnable_bags': Returnable bags T\u0026C\n- 'terms_referral': Referral program T\u0026C\n- 'terms_xtra_challenge': Xtra challenge T\u0026C\n- 'terms_sgr': SGR service T\u0026C\n- 'coupon_redemption': Coupon redemption info\n- 'warranty': Warranty information\n- 'birthday_promo': Birthday promotions\n- 'small_producer_cooperation': Small producer cooperation\n- 'teamup': Team up/group ordering",
                "enum": [
                  "general",
                  "xtra_general",
                  "xtra_price",
                  "baby_club",
                  "christmas",
                  "barrier_free",
                  "referral",
                  "premium",
                  "returnable_bags",
                  "office_delivery",
                  "rohlik_point",
                  "gift_vouchers",
                  "mcp_server",
                  "farmers_cooperation",
                  "partnership",
                  "sustainability",
                  "flavor_heroes",
                  "terms_general",
                  "terms_baby_club",
                  "terms_returnable_bags",
                  "terms_referral",
                  "terms_xtra_challenge",
                  "terms_sgr",
                  "coupon_redemption",
                  "warranty",
                  "birthday_promo",
                  "small_producer_cooperation",
                  "teamup"
                ],
                "type": "string"
              },
              "force_refresh": {
                "default": false,
                "description": "Bypass cache and fetch fresh content",
                "type": "boolean"
              }
            },
            "type": "object"
          }
        },
        {
          "name": "get_url_content",
          "description": "Scrape URL content to markdown. Supports actions (click, wait, scroll) for dynamic pages. Defaults to user's region homepage if no URL. Use for homepage/FAQ/terms/blog/career pages. For job listings use https://career.rohlik.group/group/jobs. Set include_images=true for image URLs (use ![desc](url) in markdown). Cached unless actions used; use force_refresh to bypass.",
          "inputSchema": {
            "properties": {
              "url": {
                "anyOf": [
                  {
                    "type": "string"
                  },
                  {
                    "type": "null"
                  }
                ],
                "default": null,
                "description": "URL to scrape and retrieve content from. Supports any valid HTTP/HTTPS URL. If not provided, defaults to the user's region homepage (e.g., https://www.rohlik.cz for Czech users, https://www.knuspr.de for German users, etc.). Examples: FAQ pages, terms of service, about pages, or any public web content."
              },
              "actions": {
                "anyOf": [
                  {
                    "items": {
                      "additionalProperties": true,
                      "type": "object"
                    },
                    "type": "array"
                  },
                  {
                    "type": "null"
                  }
                ],
                "default": null,
                "description": "List of actions to perform before scraping. Each action is a dict with 'type' and action-specific params. Supported types: 'click' (requires 'selector'), 'wait' (requires 'milliseconds'), 'scroll' (optional 'direction' or 'selector'), 'write' (requires 'text'), 'press' (requires 'key'). Example: [{'type': 'click', 'selector': '#cookie-accept'}, {'type': 'wait', 'milliseconds': 1000}]. Use for: accepting cookies, navigating menus, loading dynamic content, clicking buttons. Note: Actions bypass caching as they produce dynamic results."
              },
              "include_links": {
                "default": false,
                "description": "If True, return extracted page links in addition to content. Useful for navigation discovery.",
                "type": "boolean"
              },
              "include_html": {
                "default": false,
                "description": "If True, return page HTML structure to discover CSS selectors for actions. HTML is truncated to 50000 characters to prevent token overflow.",
                "type": "boolean"
              },
              "include_images": {
                "default": false,
                "description": "If True, return image URLs with descriptions from the page. Image URLs are not cached. Use these URLs to embed images in markdown responses with ![description](url). Images are deduplicated by base URL and limited to max_images.",
                "type": "boolean"
              },
              "max_images": {
                "default": 20,
                "description": "Maximum number of images to return when include_images=True. Default is 20. Images are deduplicated by base URL to remove size variations. Use lower values (5-10) for homepages, higher values (20-50) for galleries.",
                "maximum": 100,
                "minimum": 1,
                "type": "integer"
              },
              "force_refresh": {
                "default": false,
                "description": "If True, bypass cache and fetch fresh content from the URL",
                "type": "boolean"
              }
            },
            "type": "object"
          }
        },
        {
          "name": "submit_claim",
          "description": "Process warranty claims for missing, damaged, or poor quality items. Credits customer account automatically. Each item needs inventoryId, claimedPieces, and reason. Reasons: missing_item, bad_quality, damaged_item, grocery_substitution, bad_expiration_date, bad_weight, pests, other. Match reason to customer's specific complaint.",
          "inputSchema": {
            "$defs": {
              "ClaimItem": {
                "description": "Individual item for warranty claim submission.",
                "properties": {
                  "inventoryId": {
                    "description": "Inventory ID from order details",
                    "type": "integer"
                  },
                  "claimedPieces": {
                    "description": "Number of pieces to claim",
                    "minimum": 1,
                    "type": "integer"
                  },
                  "reason": {
                    "description": "Reason for the claim",
                    "enum": [
                      "missing_item",
                      "bad_quality",
                      "damaged_item",
                      "grocery_substitution",
                      "bad_expiration_date",
                      "bad_weight",
                      "pests",
                      "other"
                    ],
                    "type": "string"
                  }
                },
                "required": [
                  "inventoryId",
                  "claimedPieces",
                  "reason"
                ],
                "type": "object"
              }
            },
            "properties": {
              "order_id": {
                "description": "Order ID for the claim",
                "type": "integer"
              },
              "items": {
                "description": "List of items to claim, each containing inventoryId, claimedPieces, and reason",
                "items": {
                  "$ref": "#/$defs/ClaimItem"
                },
                "type": "array"
              },
              "gave_up_credits": {
                "default": false,
                "description": "Whether customer wants to give credits to charity",
                "type": "boolean"
              }
            },
            "required": [
              "order_id",
              "items"
            ],
            "type": "object"
          }
        },
        {
          "name": "submit_credit_compensation",
          "description": "Compensate customers for collateral damage when one damaged product affects others (e.g., spilled liquid ruining nearby items). NOT for the damaged item itself (use submit_claim for that). Each product needs inventoryId and productName. Severity: Low (minor stain), Medium (partially ruined), High (completely destroyed). Default: Medium.",
          "inputSchema": {
            "$defs": {
              "CompensationProduct": {
                "description": "Product affected by damage spread for credit compensation.",
                "properties": {
                  "inventoryId": {
                    "description": "Inventory ID from order details",
                    "type": "integer"
                  },
                  "productName": {
                    "description": "Name of the affected product",
                    "type": "string"
                  }
                },
                "required": [
                  "inventoryId",
                  "productName"
                ],
                "type": "object"
              }
            },
            "properties": {
              "order_id": {
                "description": "Order ID for the compensation",
                "type": "integer"
              },
              "products": {
                "description": "List of products affected by damage spread",
                "items": {
                  "$ref": "#/$defs/CompensationProduct"
                },
                "type": "array"
              },
              "severity": {
                "default": "Medium",
                "description": "Severity level for compensation calculation",
                "enum": [
                  "Low",
                  "Medium",
                  "High"
                ],
                "type": "string"
              }
            },
            "required": [
              "order_id",
              "products"
            ],
            "type": "object"
          }
        },
        {
          "name": "get_customer_care_workflow_prompt",
          "description": "Get step-by-step internal guidelines for handling customer care scenarios that require special procedures. Call this ONLY for claims, warranty issues, returnable bags, cancellations, or order modifications — NOT for regular shopping operations like checkout or product search.\n\nRequired inputs:\n- workflow_name (string): Name of the workflow. Must be one of:\n  - \"warranty_claim_processing\": For handling missing items, quality issues, damaged items\n  - \"returnable_bags_issue\": For processing returnable bags problems\n  - \"order_timeslot_change\": For changing order delivery timeslot\n  - \"cancel_order\": For handling customer order cancellation requests\n  - \"checkout\": For handling checkout process (only if you need procedural guidance.)\n  - \"remove_order_item\": For removing or reducing quantity of items from upcoming orders\n\nExample: {\"workflow_name\": \"warranty_claim_processing\"}",
          "inputSchema": {
            "properties": {
              "workflow_name": {
                "description": "Name of the workflow to retrieve instructions for",
                "enum": [
                  "warranty_claim_processing",
                  "returnable_bags_issue",
                  "order_timeslot_change",
                  "cancel_order",
                  "checkout",
                  "remove_order_item"
                ],
                "type": "string"
              }
            },
            "required": [
              "workflow_name"
            ],
            "type": "object"
          }
        },
        {
          "name": "get_user_reusable_bags_info",
          "description": "Check customer's reusable bag status and balance. Use when customers ask about bag charges, returns, or deposit questions. Shows how many bags are tracked at their address. For deposit refund requests, consult get_customer_care_workflow_prompt with workflow_name='returnable_bags_issue'.",
          "inputSchema": {
            "properties": {},
            "type": "object"
          }
        },
        {
          "name": "adjust_user_reusable_bags",
          "description": "Correct reusable bag count when tracking is inaccurate. Use when customer claims they returned bags but the system shows otherwise.\n\nRequired inputs:\n- number_of_reusable_bags (integer): New total bag count at user's home. Range: 0-20\n- reason_type (string, optional): Reason for adjustment. One of: \"NOT_LOGGED_IN\", \"PAPER_BAGS\", \"DELIVERY_POINT\", \"OTHER_REASON\"\n- description (string, optional): Free text explanation. Required when reason_type is \"OTHER_REASON\"\n\nExample: {\"number_of_reusable_bags\": 0, \"reason_type\": \"NOT_LOGGED_IN\"}",
          "inputSchema": {
            "properties": {
              "number_of_reusable_bags": {
                "description": "New number of reusable bags at user's home",
                "maximum": 20,
                "minimum": 0,
                "type": "integer"
              },
              "reason_type": {
                "anyOf": [
                  {
                    "enum": [
                      "NOT_LOGGED_IN",
                      "PAPER_BAGS",
                      "DELIVERY_POINT",
                      "OTHER_REASON"
                    ],
                    "type": "string"
                  },
                  {
                    "type": "null"
                  }
                ],
                "default": null,
                "description": "Reason for the adjustment"
              },
              "description": {
                "anyOf": [
                  {
                    "type": "string"
                  },
                  {
                    "type": "null"
                  }
                ],
                "default": null,
                "description": "Description when reason_type is OTHER_REASON"
              }
            },
            "required": [
              "number_of_reusable_bags"
            ],
            "type": "object"
          }
        },
        {
          "name": "get_customer_support_contact_info",
          "description": "Provide customers with ways to reach human support. Use when customers need phone, email, or WhatsApp contact details, or when escalation to live agents is appropriate.",
          "inputSchema": {
            "properties": {},
            "type": "object"
          }
        },
        {
          "name": "cancel_order",
          "description": "Cancel upcoming order (before picking starts). DESTRUCTIVE - requires two-step confirmation flow:\n1. INQUIRY ('Can I cancel?') → call with customer_confirmed=false → returns cancellation terms/conditions\n2. CONFIRMED ('Yes, cancel it') → call with customer_confirmed=true → executes cancellation\nNEVER set customer_confirmed=true without prior explicit user confirmation. Not for ASAP/delivered/picking-started orders. Fetch upcoming orders first if order_id unknown.",
          "inputSchema": {
            "properties": {
              "order_id": {
                "description": "Upcoming order ID to cancel",
                "type": "integer"
              },
              "customer_confirmed": {
                "default": false,
                "description": "Whether customer has EXPLICITLY confirmed cancellation. Set False for inquiries ('can I cancel?'), True only after explicit confirmation ('yes, cancel it').",
                "type": "boolean"
              }
            },
            "required": [
              "order_id"
            ],
            "type": "object"
          }
        },
        {
          "name": "remove_order_item",
          "description": "Remove or reduce item quantity from upcoming order (before picking starts). DESTRUCTIVE - requires two-step confirmation flow:\n1. INQUIRY ('Can I remove this?') → call with customer_confirmed=false → returns item details and terms\n2. CONFIRMED ('Yes, remove it') → call with customer_confirmed=true → executes removal\nNEVER set customer_confirmed=true without prior explicit user confirmation. Fetch order details first to get order_field_id. Set updated_amount to 0 to remove completely, or to a lower number to reduce quantity. Order must keep at least 1 item and stay above minimum value.",
          "inputSchema": {
            "properties": {
              "order_id": {
                "description": "Order ID containing the item",
                "type": "integer"
              },
              "order_field_id": {
                "description": "Order field ID of the item to remove",
                "type": "integer"
              },
              "updated_amount": {
                "description": "New quantity for the item (0 to remove completely)",
                "minimum": 0,
                "type": "number"
              },
              "customer_confirmed": {
                "default": false,
                "description": "Whether customer has EXPLICITLY confirmed removal. Set False for inquiries ('can I remove this?'), True only after explicit confirmation ('yes, remove it').",
                "type": "boolean"
              }
            },
            "required": [
              "order_id",
              "order_field_id",
              "updated_amount"
            ],
            "type": "object"
          }
        },
        {
          "name": "get_tools_by_query",
          "description": "Get tools that match classified categories for a user query.\n\nUses ML classification to determine which tool categories are relevant based on the query,\nthen returns schemas for those tools. This is the first step in the two-step tool access process.\n\n**Workflow:**\n1. Call get_tools_by_query with the user's request to discover relevant tools\n2. Review the returned tool schemas to understand available functionality\n3. Call execute_tool with the appropriate tool_name and arguments\n\n**Categories:**\n- product_search: Product search, brands, categories, product details, compositions\n- cart: Shopping cart operations (view, add, update, remove, clear)\n- recipes: Recipe search, generation, and details\n- orders: Order history, repeat order, timeslot changes, spending analysis\n- customer_care: Claims, compensation, reusable bags, order cancellation, CC workflow\n- account: User info, credits, favorites, shopping lists\n- checkout: Checkout process, delivery timeslots, payment method, packaging\n- general: FAQ, jobs, webpage content (always included)\n\n**Context enrichment:**\nPass conversation_context (e.g. conversation summary) to improve classification of short\nfollow-up messages. The classifier will embed both the query and the context in a single\nbatch call, then union the resulting categories. No state is stored between turns.\n\nReturns tool schemas with name, description, and inputSchema for each relevant tool.",
          "inputSchema": {
            "properties": {
              "user_query": {
                "description": "The user's query/request to classify. The classifier determines which tool categories are relevant.",
                "type": "string"
              },
              "conversation_context": {
                "anyOf": [
                  {
                    "type": "string"
                  },
                  {
                    "type": "null"
                  }
                ],
                "default": null,
                "description": "Optional conversation summary or context from previous turns. When provided, the classifier embeds both query and context in a single batch call and unions their categories. This ensures tools from earlier in the conversation remain available for short follow-up messages like 'yes', 'remove it', or '11.02.2026', without storing any state."
              },
              "categories": {
                "anyOf": [
                  {
                    "items": {
                      "type": "string"
                    },
                    "type": "array"
                  },
                  {
                    "type": "null"
                  }
                ],
                "default": null,
                "description": "Optional list of categories to explicitly force-include on top of classification. Valid: 'product_search', 'cart', 'recipes', 'orders', 'customer_care', 'account', 'checkout', 'general'."
              }
            },
            "required": [
              "user_query"
            ],
            "type": "object"
          }
        },
        {
          "name": "execute_tool",
          "description": "Execute a tool by name with provided arguments.\n\nThis is the second step in the two-step tool access process after discovering tools with get_tools_by_query.\n\n**Usage:**\nCall with tool_name and arguments as a JSON object in the 'arguments' parameter.\n\n**Example:**\n```json\n{\n    \"tool_name\": \"search_products\",\n    \"arguments\": {\"keyword\": \"organic milk\", \"include_fields\": [\"productId\", \"productName\", \"price\"]}\n}\n```\n\nReturns the tool's result wrapped in a response object with tool_name for reference.",
          "inputSchema": {
            "properties": {
              "tool_name": {
                "description": "Name of the tool to execute (from get_tools_by_query results).",
                "type": "string"
              },
              "arguments": {
                "anyOf": [
                  {
                    "additionalProperties": true,
                    "type": "object"
                  },
                  {
                    "type": "null"
                  }
                ],
                "default": null,
                "description": "Tool arguments as a dictionary. Pass all tool parameters here."
              }
            },
            "required": [
              "tool_name"
            ],
            "type": "object"
          }
        }
      ],
      "updated_at": "2026-02-20T19:06:16.619208+01:00"
    }
  }
}