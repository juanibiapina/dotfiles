#!/usr/bin/env bash
#
# Summary: Send text to 30% right-side split pane
#
# Usage: {cmd} <text>
#
# Sends text to the right-side split pane if it exists (visible or hidden).

set -e

# Check if text was provided
if [ $# -eq 0 ]; then
  echo "Error: No text provided"
  exit 1
fi

# Get stored IDs
PANE_ID=$(tmux show -sqv @right_split_pane)
HIDDEN_WINDOW=$(tmux show -sqv @right_split_window)

# Get current session and window
SESSION=$(tmux display-message -p '#{session_name}')
WINDOW=$(tmux display-message -p '#{window_index}')

# Check if pane exists in current window (visible)
if [ -n "$PANE_ID" ] && tmux list-panes -t "$SESSION:$WINDOW" -F "#{pane_id}" | grep -q "^$PANE_ID\$"; then
  # Pane is visible, send the text
  tmux send-keys -t "$PANE_ID" "$*" C-m

# Check if pane exists in hidden window
elif [ -n "$PANE_ID" ] && [ -n "$HIDDEN_WINDOW" ] && tmux list-panes -t "$HIDDEN_WINDOW" -F "#{pane_id}" 2>/dev/null | grep -q "^$PANE_ID\$"; then
  # Pane is hidden, send text to it there (don't bring it back)
  tmux send-keys -t "$PANE_ID" "$*" C-m

else
  echo "Error: Pane not found"
  exit 1
fi
