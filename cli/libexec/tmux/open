#!/usr/bin/env bash
#
# Summary: Open tmux session with a fuzzy finder
#
# Usage: {cmd}

set -e

# Use a temp file to capture the selection from fzf popup
tmpfile=$(mktemp)
trap "rm -f $tmpfile" EXIT

# Select project with fzf, write selection to temp file
tmux display-popup -E -w 90% -h 90% "dev list | fzf --reverse --preview 'dev preview {}' > $tmpfile" || true

# Only proceed if temp file has content (fzf wasn't cancelled)
if [ -s "$tmpfile" ]; then
  selected=$(cat "$tmpfile" | xargs)  # xargs trims whitespace
  if [ -n "$selected" ]; then
    dev open "$selected"
  fi
fi
