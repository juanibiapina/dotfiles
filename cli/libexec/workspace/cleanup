#!/usr/bin/env bash
#
# Summary: Cleanup temporary files, caches, and JS runtime versions
#
# Usage: {cmd}

set -e

source "${_DEV_ROOT}/lib/gum.sh"

header "Cleaning workspace projects..."

cd "$WORKSPACE"

for owner in *; do
  if [ -d "$owner" ]; then
    for repo in "$owner"/*; do
      if [ -d "$repo" ]; then
        (
          cd "$repo"
          rm -rf .devenv .direnv
          rm -rf node_modules bower_components
          rm -rf .pnpm-store .yarn
          rm -rf .turbo .nx

          # Framework build caches
          rm -rf .next .nuxt .vite .angular
          rm -rf .parcel-cache .cache
          rm -rf .swc

          # Linter caches
          rm -f .eslintcache .stylelintcache

          # Test/coverage
          rm -rf coverage .nyc_output

          # Build artifacts
          rm -rf storybook-static
          rm -f tsconfig.tsbuildinfo
        )
      fi
    done
  fi
done

header "Cleaning global caches..."

info "Cleaning npm"
rm -rf ~/.npm

info "Cleaning pnpm"
rm -rf ~/.pnpm-store
rm -rf ~/Library/pnpm

info "Cleaning yarn"
rm -rf ~/.yarn
rm -rf ~/.cache/yarn

info "Cleaning nvm"
rm -rf ~/.nvm

info "Cleaning mise Node.js"
rm -rf ~/.local/share/mise/installs/node
rm -rf ~/.cache/mise

info "Cleaning corepack"
rm -rf ~/.cache/node/corepack

info "Cleaning Bun"
rm -rf ~/.bun

info "Cleaning Deno"
rm -rf ~/.deno
rm -rf ~/.cache/deno

info "Cleaning Turborepo"
rm -rf ~/.cache/turbo

header "Cleaning JS/Node.js Library caches..."

info "Cleaning Cypress browsers"
rm -rf ~/Library/Caches/Cypress

info "Cleaning Playwright browsers"
rm -rf ~/Library/Caches/ms-playwright

info "Cleaning node-gyp"
rm -rf ~/Library/Caches/node-gyp

info "Cleaning TypeScript cache"
rm -rf ~/Library/Caches/typescript

info "Cleaning pnpm Library cache"
rm -rf ~/Library/Caches/pnpm

info "Cleaning global npm packages"
rm -rf ~/resources/node_modules

success
