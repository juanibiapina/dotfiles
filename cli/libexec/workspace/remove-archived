#!/usr/bin/env bash
#
# Summary: Remove local repositories that are archived on GitHub
#
# Usage: {cmd} <user>

set -e

declare -A args="($_DEV_ARGS)"

user="${args[user]}"

cd "$WORKSPACE/$user"

archived_repos=$(gh repo list "$user" --archived --json name --jq '.[].name')

if [ -z "$archived_repos" ]; then
  echo "No archived repositories found for user $user."
  exit 0
fi

echo "The following archived repositories will be removed locally:"
echo "$archived_repos"

read -p "Are you sure you want to delete these repositories locally? (y/N): " confirm
if [[ "$confirm" =~ ^[Yy]$ ]]; then
  for repo in $archived_repos; do
    echo "Removing $repo..."
    rm -rf "$repo"
  done
  echo "Archived repositories removed."
else
  echo "Operation cancelled."
fi
