#!/usr/bin/env bash
#
# Summary: List tickets for the current project
#
# Usage: {cmd}

set -e

source "${_DEV_ROOT}/lib/gum.sh"
source "${_DEV_ROOT}/lib/tickets.sh"

declare -A args="($_DEV_ARGS)"

project=$(resolve_project)
file=$(project_file "$project")

if [ ! -f "$file" ]; then
  info "No tickets for $project"
  exit 0
fi

items=$(list_items "$file")

if [ -z "$items" ]; then
  info "No tickets"
else
  echo "$items" | while IFS=$'\t' read -r id state title; do
    printf "%s %s %s\n" "$id" "$(state_icon "$state")" "$title"
  done
fi
