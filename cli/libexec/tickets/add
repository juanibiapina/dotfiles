#!/usr/bin/env bash
#
# Summary: Add a ticket to the current project
#
# Usage: {cmd} <title> [description]

set -e

source "${_DEV_ROOT}/lib/gum.sh"
source "${_DEV_ROOT}/lib/tickets.sh"

declare -A args="($_DEV_ARGS)"
title="${args[title]}"
description="${args[description]}"

if [ -z "$title" ]; then
  error "No title provided"
  exit 1
fi

project=$(resolve_project)
file=$(project_file "$project")

id=$(add_item "$file" "$project" "$title" "$description")

if [ -n "$description" ]; then
  success "Added ticket $id (refined): $title"
else
  success "Added ticket $id (new): $title"
fi
