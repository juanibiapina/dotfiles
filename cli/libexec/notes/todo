#!/usr/bin/env bash
#
# Summary: Add a todo item to the vault, organized by working directory
#
# Usage: {cmd} <text>
#
# Appends a todo checkbox to $NOTES_VAULT/Todos.md under a section
# for the current working directory (relative to ~).

set -e

source "${_DEV_ROOT}/lib/gum.sh"

declare -A args="($_DEV_ARGS)"
text="${args[text]}"

if [ -z "$text" ]; then
  error "No todo text provided"
  exit 1
fi

if [ -z "$NOTES_VAULT" ]; then
  error "NOTES_VAULT is not set"
  exit 1
fi

# Compute section heading: replace $HOME with ~
tilde="~"
section="## ${PWD/#$HOME/$tilde}"

bash "${_DEV_ROOT}/lib/todos.sh" add "$section" "$text"

success "Added todo: $text"
